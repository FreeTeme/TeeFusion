`
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const circleContainer = document.getElementById("circleContainer");
        const selectedDateDisplay = document.getElementById("selectedDateDisplay");
        const uploadSection = document.getElementById("uploadSection");
        const uploadButton = document.getElementById("uploadButton");
        const fileUpload = document.getElementById("fileUpload");
        const usernameElement = document.getElementById('username');

        // Функция для получения данных пользователя из базы данных
        async function fetchUserData(userId) {
            try {
                const response = await fetch(`/user/${userId}`); // URL вашего API
                if (!response.ok) {
                    throw new Error('Сеть ответила с ошибкой');
                }
                const data = await response.json();
                usernameElement.textContent = data.username; // Установка имени пользователя
            } catch (error) {
                console.error('Ошибка при получении данных пользователя:', error);
                usernameElement.textContent = 'Ошибка загрузки имени'; // Обработка ошибки
            }
        }

        // Вызов функции для получения данных пользователя при загрузке страницы
        fetchUserData(1); // Временный ID пользователя, позже можно передавать динамически

        const year = 2024;
        const month = 9;

        const votesData = {
            dates: [], // Даты голосования
            votes: [] // Голоса: 1 голос 2 сентября и 2 голоса 3 сентября
        };

        // Инициализация графика
        const ctx = document.getElementById('votesChart').getContext('2d');
        const votesChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: votesData.dates,
                datasets: [{
                    label: 'Вы пока не участвуюте в соревнованиях',
                    data: votesData.votes,
                    borderColor: 'rgba(153, 119, 241, 1)',
                    backgroundColor: 'rgba(153, 119, 241, 0.5)',
                    fill: true,
                }]
            },
            options: {
                scales: {
                    x: { title: { display: true, text: 'Дата' } },
                    y: { title: { display: true, text: 'Количество голосов' } }
                }
            }
        });

        const updateChart = () => {
            votesChart.update();
        };

        const getMondays = (year, month) => {
            const mondays = [];
            const date = new Date(year, month, 1);

            while (date.getDay() !== 1) {
                date.setDate(date.getDate() + 1);
            }

            while (date.getMonth() === month) {
                mondays.push(new Date(date));
                date.setDate(date.getDate() + 7);
            }

            return mondays;
        };

        const mondays = getMondays(year, month);
        mondays.forEach((monday) => {
            const circle = document.createElement("div");
            circle.className = "circle";
            circle.textContent = monday.getDate();

            circle.addEventListener("click", function () {
                selectedDateDisplay.textContent = `Вы выбрали: ${monday.toLocaleDateString("ru-RU")}`;
                document.querySelectorAll('.circle').forEach(c => c.classList.remove('selected'));
                circle.classList.add('selected');
                uploadSection.style.display = "block";
            });

            circleContainer.appendChild(circle);
        });

        uploadButton.addEventListener("click", function () {
            const selectedCircle = document.querySelector('.circle.selected');
            const file = fileUpload.files[0];
            const selectedDate = selectedCircle ? selectedCircle.textContent : null;

            if (!file || !selectedDate) {
                alert("Пожалуйста, выберите файл и дату.");
                return;
            }
            const fileName = `${year}-${month + 1}-${selectedDate}-${file.name}`;
            alert("Заявка отправлена на рассмотрение");
        });

        // Получаем данные голосования
        window.addEventListener("message", function (event) {
            if (event.data && event.data.vote && event.data.date) {
                const { vote, date } = event.data;

                if (vote === 2) {
                    if (!votesData.dates.includes(date)) {
                        votesData.dates.push(date);
                        votesData.votes.push(1);
                    } else {
                        const index = votesData.dates.indexOf(date);
                        votesData.votes[index]++;
                    }

                    updateChart();
                }
            }
        });

        function Nazad() {
            window.location.href = 'index.html';
        }
    });
</script>
`